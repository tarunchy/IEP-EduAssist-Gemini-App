<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart IEP</title>
    <style>
        
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        button, textarea, label, input[type="checkbox"], select {
            display: block;
            width: 100%;
            margin-top: 10px;
            padding: 10px;
            font-size: 18px;
        }
        label {
            font-weight: bold;
        }
        #consent {
            width: auto;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
        }

        .checkbox-label label {
            width: auto;
            margin-right: 10px;
        }


        #questions {
            margin-top: 20px;
            background-color: #f2f2f2;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0px 4px 8px rgba(0,0,0,0.1);
        }

        /* Existing styles */
        /* ... */
        .question-container {
            display: flex;
            flex-direction: column;
            margin-bottom: 10px;
        }

        .small-button {
            width: auto;
            padding: 5px 10px;
            margin-right: 5px;
            display: inline;
        }


        
    </style>
</head>
<body>

    <h1>Parent Teacher Discussion - Smart IEP</h1>
    
    <div class="checkbox-label">
        <label for="consent">Parent's Consent:</label>
        <input type="checkbox" id="consent">
    </div>
    
    
    

    <label for="studentProfile">Select Student Profile:</label>
    <select id="studentProfile">
        <option value="3-6">Kids age 3 to 6</option>
        <option value="7-12">Kids age 7 to 12</option>
        <option value="13-17">Kids age 13 to 17</option>
    </select>

    <div id="questions"></div>

    

    <button id="start">Start Recording</button>
    <button id="stop">Stop Recording</button>

    <label for="transcript">Transcript:</label>
    <textarea id="transcript" rows="10" placeholder="Your speech will appear here"></textarea>

    <script>

        // Speech Recognition setup
let currentQuestionIndex = -1;
let shouldStop = false;
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
const recognition = new SpeechRecognition();
recognition.continuous = true;

// IEP Questions
const iepQuestions = {
    '3-6': [
        "Is the child able to communicate basic needs?",
        "How well does the child interact with peers?",
        "Is the child able to focus on tasks for a reasonable amount of time?",
        "Does the child respond well to structured activities?",
        "How does the child handle transitions between activities?"
    ],
    '7-12': [
        "How is the student performing in reading and math?",
        "Is the student able to complete homework independently?",
        "Does the student participate in class discussions?",
        "How well does the student manage time during class?",
        "Is the student organized?"
    ],
    '13-17': [
        "How is the student's academic performance?",
        "Is the student considering post-secondary education?",
        "Does the student have career interests?",
        "How well does the student manage stress?",
        "Is the student showing independence and self-advocacy skills?"
    ]
};

// Function to handle individual question's Start button
function startRecording(questionIndex) {
    if (document.getElementById('consent').checked) {
        currentQuestionIndex = questionIndex;  // Update the current question index
        const questionText = iepQuestions[document.getElementById('studentProfile').value][questionIndex];
        const speech = new SpeechSynthesisUtterance(questionText);
        
        speech.onend = function() {
            recognition.start();
        };
        
        window.speechSynthesis.speak(speech);
    } else {
        alert('Please obtain parent\'s consent before starting the recording.');
    }
    shouldStop = false;
}

// Function to handle individual question's Stop button
function stopRecording(questionIndex) {
    shouldStop = true; // set the flag to true so that recognition doesn't restart
    recognition.stop();
}

// Array to hold multiple SpeechRecognition objects
const recognitions = [];

// Display questions based on profile selection
function displayQuestions() {
    const profile = document.getElementById('studentProfile').value;
    const questions = iepQuestions[profile];
    let html = '';
    for (let i = 0; i < questions.length; i++) {
        const question = questions[i];

        html += `<div class="question-container">
                <label>${question}</label>
                <div>
                    <button class="small-button" onclick="startRecording(${i})">Start</button>
                    <button class="small-button" onclick="stopRecording(${i})">Stop</button>
                </div>
                <textarea id="answer-${i}" rows="3"></textarea>
            </div>`;
    }
    document.getElementById('questions').innerHTML = html;
}

// Initial display and event listeners
displayQuestions();
document.getElementById('studentProfile').addEventListener('change', displayQuestions);

// On start of speech recognition
recognition.onstart = function() {
    console.log('Voice is activated');
};

// On end of speech recognition
recognition.onend = function() {
    console.log('Voice is deactivated');
    if (!shouldStop) {
        recognition.start();
    }
};

// Handling the result from recognition
recognition.onresult = function(event) {
    const transcript = event.results[0][0].transcript;
    document.getElementById(`answer-${currentQuestionIndex}`).value += transcript;
};  

// Global Start and Stop button event listeners
document.getElementById('start').addEventListener('click', function() {
    if (document.getElementById('consent').checked) {
        recognition.start();
    } else {
        alert('Please obtain parent\'s consent before starting the recording.');
    }
});

document.getElementById('stop').addEventListener('click', function() {
    recognition.stop();
});

    </script>

</body>
</html>
